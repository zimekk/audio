(self.webpackChunk_dev_web=self.webpackChunk_dev_web||[]).push([[295],{295:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var s=n(699),i=n.n(s),r=n(784);class o extends(i()){constructor(){super(),this.FFTSIZE=2048,this.stream=null,this.audioContext=new AudioContext,this.analyser=this.audioContext.createAnalyser(),this.gainNode=this.audioContext.createGain(),this.microphone=null,this.gainNode.gain.value=0,this.analyser.fftSize=this.FFTSIZE,this.analyser.smoothingTimeConstant=0,this.frequencyBufferLength=this.FFTSIZE,this.frequencyBuffer=new Float32Array(this.frequencyBufferLength),this.strings={e2:{offset:Math.round(this.audioContext.sampleRate/82.4069),difference:0},a2:{offset:Math.round(this.audioContext.sampleRate/110),difference:0},d3:{offset:Math.round(this.audioContext.sampleRate/146.832),difference:0},g3:{offset:Math.round(this.audioContext.sampleRate/195.998),difference:0},b3:{offset:Math.round(this.audioContext.sampleRate/246.932),difference:0},e4:{offset:Math.round(this.audioContext.sampleRate/329.628),difference:0}},this.stringsKeys=Object.keys(this.strings),this.lastRms=0,this.rmsThreshold=.006,this.assessedStringsInLastFrame=!1,this.assessStringsUntilTime=0,this.dispatchAudioData=this.dispatchAudioData.bind(this),this.sortStringKeysByDifference=this.sortStringKeysByDifference.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}requestUserMedia(){navigator.getUserMedia({audio:!0},(e=>{this.sendingAudioData=!0,this.stream=e,this.microphone=this.audioContext.createMediaStreamSource(e),this.microphone.connect(this.analyser),this.analyser.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),requestAnimationFrame(this.dispatchAudioData)}),(e=>{alert("Unable to access the microphone")}))}attached(){document.addEventListener("visibilitychange",this.onVisibilityChange),this.onVisibilityChange()}detached(){this.sendingAudioData=!1}onVisibilityChange(){document.hidden?(this.sendingAudioData=!1,this.stream&&(this.stream.getAudioTracks().forEach((e=>{"stop"in e&&e.stop()})),"stop"in this.stream&&this.stream.stop()),this.stream=null):this.requestUserMedia()}sortStringKeysByDifference(e,t){return this.strings[e].difference-this.strings[t].difference}autocorrelateAudioData(e){let t=.5*this.frequencyBufferLength,n=null,s=0,i=0,r=0,o=this.assessedStringsInLastFrame;this.analyser.getFloatTimeDomainData(this.frequencyBuffer);for(let e=0;e<this.frequencyBuffer.length;e++)r+=this.frequencyBuffer[e]*this.frequencyBuffer[e];if(r=Math.sqrt(r/this.frequencyBuffer.length),r<.008)return 0;if(r>this.lastRms+this.rmsThreshold&&(this.assessStringsUntilTime=e+250),e<this.assessStringsUntilTime){this.assessedStringsInLastFrame=!0;for(let e=0;e<this.stringsKeys.length;e++){n=this.stringsKeys[e],s=this.strings[n].offset,i=0,!1===o&&(this.strings[n].difference=0);for(let e=0;e<t;e++)i+=Math.abs(this.frequencyBuffer[e]-this.frequencyBuffer[e+s]);i/=t,this.strings[n].difference+=i*s}}else this.assessedStringsInLastFrame=!1;!0===o&&!1===this.assessedStringsInLastFrame&&this.stringsKeys.sort(this.sortStringKeysByDifference);let a=this.strings[this.stringsKeys[0]],u=a.offset-10,h=a.offset+10,f=a.offset,c=Number.POSITIVE_INFINITY;for(let e=u;e<h;e++){i=0;for(let n=0;n<t;n++)i+=Math.abs(this.frequencyBuffer[n]-this.frequencyBuffer[n+e]);if(i/=t,i<c&&(c=i,f=e),i<.001){f=e;break}}return this.lastRms=r,this.audioContext.sampleRate/f}dispatchAudioData(e){this.sendingAudioData&&requestAnimationFrame(this.dispatchAudioData);let t=this.autocorrelateAudioData(e);if(0===t)return;let n=12*Math.log2(t/440),s=4+(9+n)/12;s=Math.floor(s);let i=(12+Math.round(n)%12)%12;this.emit("audio-data",{frequency:t,octave:s,note:i})}}class a{constructor(e){this.audioProcessor=e,this.requestedAnimationFrame=!1,this.tolerance=.006,this.frequencyToRender=-1,this.frequencies={e2:82.4069,a2:110,d3:146.832,g3:195.998,b3:246.942,e4:329.628},this.linearizedFrequencies={e2:Math.log2(this.frequencies.e2/440),a2:Math.log2(this.frequencies.a2/440),d3:Math.log2(this.frequencies.d3/440),g3:Math.log2(this.frequencies.g3/440),b3:Math.log2(this.frequencies.b3/440),e4:Math.log2(this.frequencies.e4/440)},this.onAudioData=this.onAudioData.bind(this)}attached({frequencyMessage:e,stringFrequencyMessage:t,smallestDistanceKey:n}){this.frequencyMessage=e.current,this.stringFrequencyMessage=t.current,this.smallestDistanceKey=n.current,this.audioProcessor.on("audio-data",this.onAudioData)}detached(){this.audioProcessor.off("audio-data",this.onAudioData)}onAudioData({frequency:e}){let t=Math.log2(e/440),n={e2:t-this.linearizedFrequencies.e2,a2:t-this.linearizedFrequencies.a2,d3:t-this.linearizedFrequencies.d3,g3:t-this.linearizedFrequencies.g3,b3:t-this.linearizedFrequencies.b3,e4:t-this.linearizedFrequencies.e4},s=Object.keys(n),i=Number.MAX_VALUE,r="";for(let e=0;e<s.length;e++){let t=s[e];Math.abs(n[t])<i&&(i=n[t],r=t)}-1===this.frequencyToRender&&(this.frequencyToRender=e),this.frequencyToRender+=.15*(e-this.frequencyToRender),this.frequencyMessage.textContent=this.frequencyToRender.toFixed(2)+"Hz",this.stringFrequencyMessage.textContent=this.frequencies[r].toFixed(2)+"Hz",this.smallestDistanceKey.textContent=r}}function u(){const e=(0,r.useRef)(),t=(0,r.useRef)(),n=(0,r.useRef)(),[s]=(({frequencyMessage:e,stringFrequencyMessage:t,smallestDistanceKey:n})=>{const[s,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(s){const s=new o;s.attached(),new a(s).attached({frequencyMessage:e,stringFrequencyMessage:t,smallestDistanceKey:n})}}),[s]),[i]})({frequencyMessage:e,stringFrequencyMessage:t,smallestDistanceKey:n});return r.createElement("div",null,"Tuner",r.createElement("button",{onClick:e=>s(!0)},"start"),r.createElement("div",null,"frequencyMessage: ",r.createElement("span",{ref:e})),r.createElement("div",null,"stringFrequencyMessage: ",r.createElement("span",{ref:t})),r.createElement("div",null,"smallestDistanceKey: ",r.createElement("span",{ref:n})))}},699:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,s){function i(n){e.removeListener(t,r),s(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&g(e,"error",t,{once:!0})}(e,i)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function h(e,t,n,s){var i,r,o,h;if(a(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),o=r[t]),void 0===o)o=r[t]=n,++e._eventsCount;else if("function"==typeof o?o=r[t]=s?[n,o]:[o,n]:s?o.unshift(n):o.push(n),(i=u(e))>0&&o.length>i&&!o.warned){o.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=o.length,h=f,console&&console.warn&&console.warn(h)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(e,t,n){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(s);return i.listener=n,s.wrapFn=i,i}function l(e,t,n){var s=e._events;if(void 0===s)return[];var i=s[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),s=0;s<t;++s)n[s]=e[s];return n}function g(e,t,n,s){if("function"==typeof e.on)s.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(r){s.once&&e.removeEventListener(t,i),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");o=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return u(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var h=u.length,f=y(u,h);for(n=0;n<h;++n)s(f[n],this,t)}return!0},r.prototype.addListener=function(e,t){return h(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return h(this,e,t,!0)},r.prototype.once=function(e,t){return a(t),this.on(e,c(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,c(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,s,i,r,o;if(a(t),void 0===(s=this._events))return this;if(void 0===(n=s[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){o=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(s[e]=n[0]),void 0!==s.removeListener&&this.emit("removeListener",e,o||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,s;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,r=Object.keys(n);for(s=0;s<r.length;++s)"removeListener"!==(i=r[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this},r.prototype.listeners=function(e){return l(this,e,!0)},r.prototype.rawListeners=function(e){return l(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},r.prototype.listenerCount=d,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}}]);